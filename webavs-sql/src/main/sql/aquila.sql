-- FERCIAM - S190624_004-SPE-Importation messages eLP dans WebAVS
INSERT INTO SCHEMA.JADEPROP (PROPNAME,PROPVAL,CSPY,PSPY) VALUES ('aquila.receptionMessagesELP','false','20200207150736GLOBAZ   ','20200207150736GLOBAZ   ');
INSERT INTO SCHEMA.JADEPROP (PROPNAME,PROPVAL,CSPY,PSPY) VALUES ('aquila.repertoireGestionMessagesELP','','20200207150736GLOBAZ   ','20200207150736GLOBAZ   ');
INSERT INTO SCHEMA.JADEPROP (PROPNAME,PROPVAL,CSPY,PSPY) VALUES ('aquila.destinataireProtocoleMessagesELP','','20200207150736GLOBAZ   ','20200207150736GLOBAZ   ');

-- [WEBAVS-7125] QR Facture : Ajout du paramètre
INSERT INTO SCHEMA.JADEPROP (PROPNAME,PROPVAL,CSPY,PSPY) VALUES ('common.qrFacture','false','20191209150736ccjuglo   ','20191209150736ccjuglo   ');

-- [WEBAVS-7476] INFOROM - S200212_004 Explications sur envoi données au REE / OFS
UPDATE SCHEMA.JADEPROP
SET PROPVAL='01.01', PSPY='20200224150736mmo' where PROPNAME = 'pavo.annonce.periode.debut';

-- FERCIAM WEBAVS-7349//////////////////////////////////////////////////////////////////////
--SCRIPT FERCIAM
-- Insertion de la nouvelle étape
INSERT INTO SCHEMA.COETAPP (ODIETA,OFISEQ,ODTACT,ODTETA,ODMMIN,PSPY) VALUES (87,1,5300059,5200060,20.00,'2020031710490000Globaz  ');

-- Ajout des codes Sys
INSERT INTO SCHEMA.FWCOSP (PCOSID,PPTYGR,PCONCS,PPTYCN,PPTYCL,PPTYSA,PCOSLI,PCOSDF,PCOSDM,PCOSDP,PCOIAN,PCOIDE,PCODFI,PCOITC,PCOISE,PSPY) VALUES (5300059,'COETAEP   ',35,1,0,0,'Envoyer un 2ème rappel',2,2,2,2,2,2,15000002,0,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.FWCOUP (PCOSID,PLAIDE,PCOUID,PCOLUT,PSPY) VALUES (5300059,'D','          ','Eine zweite Mahnung senden','2020031710490000Globaz  ');
INSERT INTO SCHEMA.FWCOUP (PCOSID,PLAIDE,PCOUID,PCOLUT,PSPY) VALUES (5300059,'F','          ','Envoyer un deuxième rappel','2020031710490000Globaz  ');

-- Suppresion d'anciens codes sys avec 2eme rappel
DELETE FROM SCHEMA.FWCOSP
WHERE PCOSID = (SELECT PCOSID FROM SCHEMA.FWCOUP
                WHERE PCOLUT like '%Deuxième rappel envoyé%');

DELETE FROM SCHEMA.FWCOUP
WHERE PCOSID = (SELECT PCOSID FROM SCHEMA.FWCOUP
                WHERE PCOLUT like '%Deuxième rappel envoyé%');

INSERT INTO SCHEMA.FWCOSP (PCOSID,PPTYGR,PCONCS,PPTYCN,PPTYCL,PPTYSA,PCOSLI,PCOSDF,PCOSDM,PCOSDP,PCOIAN,PCOIDE,PCODFI,PCOITC,PCOISE,PSPY) VALUES (5200060,'COETAPP   ',35,1,0,0,'2ème rappel envoyé',2,2,2,2,2,2,15000002,0,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.FWCOUP (PCOSID,PLAIDE,PCOUID,PCOLUT,PSPY) VALUES (5200060,'D','          ','Zweite abgesandte Mahnung','2020031710490000Globaz  ');
INSERT INTO SCHEMA.FWCOUP (PCOSID,PLAIDE,PCOUID,PCOLUT,PSPY) VALUES (5200060,'F','          ','Deuxième rappel envoyé','2020031710490000Globaz  ');

-- Ajout des transitions pour premier rappel
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (661,30,39,'saisie_email.jsp',14,'COExecuterDecision','1','1',10,'2020031710490000Globaz  ',5400002,0,0);
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (663,30,87,'saisie_date_delai_paiement.jsp',14,'CO002ExecuterDeuxiemeRappel','1','2',1,'2020031710490000Globaz  ',5400002,0,0);
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (662,30,1,'envoi_rdp.jsp',30,'CO005ExecuterRDP','1','2',0,'2020031710490000Globaz  ',5400002,0,0);

-- suppresion des décisions pour premier rappel
DELETE FROM SCHEMA.COTRANP
WHERE OGITRA = (SELECT OGITRA FROM SCHEMA.COTRANP
                WHERE ODIETA = 39
                  AND OGIESU = 30);

-- suppression des réquisitions de poursuite pour le premier rappel
DELETE FROM SCHEMA.COTRANP
WHERE OGITRA = (SELECT OGITRA FROM SCHEMA.COTRANP
                WHERE ODIETA = 1
                  AND OGIESU = 30);

-- Ajout des transitions pour deuxième rappel
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (664,87,1,'envoi_rdp.jsp',30,'CO005ExecuterRDP','1','2',0,'2020031710490000Globaz  ',5400002,0,0);
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (665,87,22,'passer_irrecouvrables.jsp',30,'CO037ExecuterIrrecouvrable','1','2',0,'2020031710490000Globaz  ',5400002,0,0);
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (666,87,42,'blank.jsp',0,'COExecuterEtapeManuelle','1','2',0,'                        ',5400001,0,0);

-- Ajout du deuxième rappel aprés décision
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (668,39,87,'saisie_date_delai_paiement.jsp',14,'CO002ExecuterDeuxiemeRappel','1','2',1,'2020031710490000Globaz  ',5400002,0,0);

-- Ajout du premier rappel aprés Sommation
INSERT INTO SCHEMA.COTRANP (OGITRA,ODIETA,OGIESU,OGLSNI,OGNDUR,OGLACT,OGBMAN,OGBAUT,OGNPRI,PSPY,OGTDEL,OGNDUP,OGTDEP) VALUES (667,31,30,'saisie_date_delai_paiement.jsp',14,'CO001ExecuterPremierRappel','1','2',1,'2020031710490000Globaz  ',5400002,0,0);


-- Update de l'incrément
UPDATE SCHEMA.FWINCP
SET PINCVA = (select max(ODIETA) FROM SCHEMA.COETAPP)
WHERE PINCID like '%COETAPP%';

UPDATE SCHEMA.FWINCP
SET PINCVA = (select max(OGITRA) FROM SCHEMA.COTRANP)
WHERE PINCID like '%COTRANP%';


-- Création du catalogue de texte

-- Insert Deuxième rappel dans type Catalogue de textes
INSERT INTO SCHEMA.CTTYPDOC (CAITYD,CATDOM,CATTYP,PSPY,CANBIN,CAIGAN) VALUES (15000050,5600001,5300059,'                        ',61100000001,null);

INSERT INTO SCHEMA.CTDOCUME (CBIDOC,CBLNOM,CBBACT,CBBDEF,CBDDES,CBTEDI,CBTDES,CBITYD,PSPY,CBBSTY) VALUES (61100000001,'Deuxième rappel','1','1',0,34000001,0,15000050,'2020031710490000Globaz  ','2');

INSERT INTO SCHEMA.CTELEMEN (CCIELE,CCIDOC,CCNPOS,CCNNIV,PSPY,CCBSBD,CCBDES,CCBSEL,CCBEDI) VALUES (61100000001,61100000001,1,1,'2020031710490000Globaz  ','2','                    ','2','2');
INSERT INTO SCHEMA.CTELEMEN (CCIELE,CCIDOC,CCNPOS,CCNNIV,PSPY,CCBSBD,CCBDES,CCBSEL,CCBEDI) VALUES (61100000002,61100000001,1,2,'2020031710490000Globaz  ','2','                    ','2','2');
INSERT INTO SCHEMA.CTELEMEN (CCIELE,CCIDOC,CCNPOS,CCNNIV,PSPY,CCBSBD,CCBDES,CCBSEL,CCBEDI) VALUES (61100000003,61100000001,2,2,'2020031710490000Globaz  ','2','                    ','2','2');
INSERT INTO SCHEMA.CTELEMEN (CCIELE,CCIDOC,CCNPOS,CCNNIV,PSPY,CCBSBD,CCBDES,CCBSEL,CCBEDI) VALUES (61100000004,61100000001,3,2,'2020031710490000Globaz  ','2','                    ','2','2');
INSERT INTO SCHEMA.CTELEMEN (CCIELE,CCIDOC,CCNPOS,CCNNIV,PSPY,CCBSBD,CCBDES,CCBSEL,CCBEDI) VALUES (61100000005,61100000001,4,2,'2020031710490000Globaz  ','2','                    ','2','2');

INSERT INTO SCHEMA.CTTEXTES (CDITXT,CDLDES,CDLCIL,CDIELE,PSPY) VALUES (61100000001,'Deuxième rappel - {0}','fr',61100000001,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.CTTEXTES (CDITXT,CDLDES,CDLCIL,CDIELE,PSPY) VALUES (61100000002,'{0},','fr',61100000002,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.CTTEXTES (CDITXT,CDLDES,CDLCIL,CDIELE,PSPY) VALUES (61100000003,'En vérifiant notre comptabilité, nous constatons que le versement de CHF {1} à nous régler jusqu¬au {2} ne nous est pas encore parvenu. Nous vous prions de vous en acquitter avant le {3}.','fr',61100000003,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.CTTEXTES (CDITXT,CDLDES,CDLCIL,CDIELE,PSPY) VALUES (61100000004,'Si votre paiement a croisé notre rappel, nous vous prions d¬ignorer ce dernier.','fr',61100000004,'2020031710490000Globaz  ');
INSERT INTO SCHEMA.CTTEXTES (CDITXT,CDLDES,CDLCIL,CDIELE,PSPY) VALUES (61100000005,'Nous vous prions d¬agréer, {0}, nos salutations distinguées.','fr',61100000005,'2020031710490000Globaz  ');


-- Rattrapage des données

-- Update de l'historique
UPDATE SCHEMA.COHISTP
SET ODIETA = 87
WHERE OEIHIS IN (SELECT OEIHIS FROM SCHEMA.COHISTP
                 WHERE ODIETA IN (SELECT ODIETA FROM SCHEMA.COETAPP
                                  WHERE ODTETA IN (SELECT DISTINCT PCOSID FROM SCHEMA.FWCOUP
                                                   WHERE PCOLUT like '%Premier rappel%')
                                    AND OFISEQ = 1));

-- Update de CAOPERP
UPDATE SCHEMA.CAOPERP
SET IDCONTREPARTIE = 87
WHERE IDOPERATION IN (SELECT IDOPERATION FROM SCHEMA.CAOPERP
                      WHERE IDCONTREPARTIE IN (SELECT ODIETA FROM SCHEMA.COETAPP
                                               WHERE ODTETA IN (SELECT DISTINCT PCOSID FROM SCHEMA.FWCOUP
                                                                WHERE PCOLUT like '%Premier rappel%')
                                                 AND OFISEQ = 1));

-- Update COCAVSP
UPDATE SCHEMA.COCAVSP
SET ODIETA = 87
WHERE OAICON IN (SELECT OAICON FROM SCHEMA.COCAVSP
                 WHERE ODIETA IN (SELECT ODIETA FROM SCHEMA.COETAPP
                                  WHERE ODTETA IN (SELECT DISTINCT PCOSID FROM SCHEMA.FWCOUP
                                                   WHERE PCOLUT like '%Premier rappel%')
                                    AND OFISEQ = 1))
--// FIN FERCIAM //////////////////////////////////////////////////////////////////////////////////
