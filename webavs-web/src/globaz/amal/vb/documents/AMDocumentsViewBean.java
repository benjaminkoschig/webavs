/**
 * 
 */
package globaz.amal.vb.documents;

import globaz.globall.db.BSession;
import globaz.globall.db.BSessionUtil;
import globaz.globall.db.BSpy;
import globaz.globall.vb.BJadePersistentObjectViewBean;
import java.util.HashMap;
import ch.globaz.amal.business.constantes.IAMCodeSysteme;
import ch.globaz.amal.business.models.controleurEnvoi.SimpleControleurEnvoiStatusSearch;
import ch.globaz.amal.business.models.controleurEnvoi.SimpleControleurJob;
import ch.globaz.amal.businessimpl.services.AmalImplServiceLocator;

/**
 * @author dhi
 * 
 */
public class AMDocumentsViewBean extends BJadePersistentObjectViewBean {

    private SimpleControleurJob currentJob = null;

    /**
     * Default constructor
     */
    public AMDocumentsViewBean() {
        super();
        setCurrentJob(new SimpleControleurJob());
    }

    /**
     * Constructor called from rcListe
     * 
     * @param job
     */
    public AMDocumentsViewBean(SimpleControleurJob job) {
        this();
        setCurrentJob(job);
    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#add()
     */
    @Override
    public void add() throws Exception {
        // TODO Auto-generated method stub

    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#delete()
     */
    @Override
    public void delete() throws Exception {
        // TODO Auto-generated method stub

    }

    /**
     * @return the currentJob
     */
    public SimpleControleurJob getCurrentJob() {
        return currentJob;
    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#getId()
     */
    @Override
    public String getId() {
        // TODO Auto-generated method stub
        return null;
    }

    public String getNbDocumentsForCurrentJob() {
        SimpleControleurEnvoiStatusSearch currentSearch = new SimpleControleurEnvoiStatusSearch();
        currentSearch.setForIdJob(getCurrentJob().getIdJob());
        try {
            return "" + AmalImplServiceLocator.getSimpleControleurEnvoiStatusService().count(currentSearch);
        } catch (Exception ex) {
            ex.printStackTrace();
            return "0";
        }

    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.vb.BJadePersistentObjectViewBean#getSpy()
     */
    @Override
    public BSpy getSpy() {
        // TODO Auto-generated method stub
        return null;
    }

    /**
     * Retourne la liste à afficher dans la combobox de sélection de status pour un job
     * 
     * HashMap<value, libelle>
     * 
     * @param job
     * @return
     */
    public HashMap<String, String> getStatusListJob(SimpleControleurJob job) {
        HashMap<String, String> aReturn = new HashMap<String, String>();
        BSession currentSession = BSessionUtil.getSessionFromThreadContext();

        // Récupération des codes systèmes
        for (int iIndexCS = 0; iIndexCS < IAMCodeSysteme.AMDocumentStatus.values().length; iIndexCS++) {
            String key = IAMCodeSysteme.AMDocumentStatus.values()[iIndexCS].getValue();
            String value = currentSession.getCodeLibelle(key);
            aReturn.put(key, value);
        }
        // Suppression des status inutiles UI
        if (job.getTypeJob().equals(IAMCodeSysteme.AMJobType.JOBMANUALEDITED.getValue())) {
            aReturn.remove(IAMCodeSysteme.AMDocumentStatus.AUTOGENERATED.getValue());
        } else {
            aReturn.remove(IAMCodeSysteme.AMDocumentStatus.MANUALGENERATED.getValue());
        }
        aReturn.remove(IAMCodeSysteme.AMDocumentStatus.INPROGRESS.getValue());
        aReturn.remove(IAMCodeSysteme.AMDocumentStatus.ERROR.getValue());

        return aReturn;
    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#retrieve()
     */
    @Override
    public void retrieve() throws Exception {
        // TODO Auto-generated method stub

    }

    /**
     * @param currentJob
     *            the currentJob to set
     */
    public void setCurrentJob(SimpleControleurJob currentJob) {
        this.currentJob = currentJob;
    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#setId(java.lang.String)
     */
    @Override
    public void setId(String newId) {
        // TODO Auto-generated method stub

    }

    /*
     * (non-Javadoc)
     * 
     * @see globaz.globall.db.BIPersistentObject#update()
     */
    @Override
    public void update() throws Exception {
        // TODO Auto-generated method stub

    }

}
