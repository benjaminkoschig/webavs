<?xml version="1.0" encoding="iso-8859-1"?>
<queries>
	<query name="summary">
		<comment>
			
		</comment>
		<sql>
			<![CDATA[ 
				SELECT PCPCACC1.CUTGEN AS CS_GENRE_PCA,
					PCPCACC1.CUDFIN AS DATE_FIN_PCA,
					PCPCACC1.CUTRBE AS CS_ROLE_BENEFICIAIRE,
					PCPCACC1.CUTETA AS CS_ETAT_PCA,
					PCPCACC1.CUIPCA AS ID_PCA,
					TIPAVSP1.HXNAVS AS NSS,
					REPRACC1.ZTITBE AS ID_TIERS,
					PCPCACC1.CUTTYP AS CS_TYPE_PCA,
					PCPCACC1.CUDDEB AS DATE_DEBUT_PCA,
					PCDEMPC1.BBIDOS AS ID_DOSSIER,
					PCDROIT1.BCIDRO AS ID_DROIT
					FROM SCHEMA.PCPCACC PCPCACC1
					INNER JOIN SCHEMA.PCVERDRO PCVERDRO1 ON ( PCPCACC1.CUIVDR=PCVERDRO1.BDIVDR )
					INNER JOIN SCHEMA.PCDROIT PCDROIT1 ON ( PCVERDRO1.BDIDRO=PCDROIT1.BCIDRO )
					INNER JOIN SCHEMA.PCDEMPC PCDEMPC1 ON ( PCDROIT1.BCIDPC=PCDEMPC1.BBIDPC )
					INNER JOIN SCHEMA.REPRACC REPRACC1 ON ( PCPCACC1.CUIPRA=REPRACC1.ZTIPRA ) 
					INNER JOIN SCHEMA.TIPAVSP TIPAVSP1 ON ( REPRACC1.ZTITBE=TIPAVSP1.HTITIE )
					WHERE
					(
					   PCPCACC1.CUTETA=64029002
					   AND ( REPRACC1.ZTITBE = :forIdTiers )
					   AND PCPCACC1.CUBSUP = 2
					   and PCPCACC1.CUDDEB =
					   (
					      select
					      MAX( PCPCACC2.CUDDEB )
					      from  SCHEMA.PCDEMPC PCDEMPC2 
					      inner join SCHEMA.PCDROIT PCDROIT2 on PCDROIT2.BCIDPC = PCDEMPC2.BBIDPC
					      inner join SCHEMA.PCVERDRO PCVERDRO2 on PCVERDRO2.BDIDRO = PCDROIT2.BCIDRO 
					      inner join SCHEMA.PCPCACC PCPCACC2 on PCPCACC2.CUIVDR = PCVERDRO2.BDIVDR
					      where PCDEMPC2.BBIDOS = PCDEMPC1.BBIDOS  
					        AND PCPCACC2.CUBSUP = 2 
					        and PCPCACC2.CUTETA=64029002 
					   )
					)
					union
					SELECT
				     PCPCACC1.CUTGEN AS CS_GENRE_PCA,
					PCPCACC1.CUDFIN AS DATE_FIN_PCA,
					PCPCACC1.CUTRBE AS CS_ROLE_BENEFICIARE,
					PCPCACC1.CUTETA AS CS_ETAT_PCA,
					PCPCACC1.CUIPCA AS ID_PCA,
					TIPAVSP1.HXNAVS AS NSS,
					REPRACC1.ZTITBE AS ID_TIERS,
					PCPCACC1.CUTTYP AS CS_TYPE_PCA,
					PCPCACC1.CUDDEB AS DATE_DEBUT_PCA,
					PCDEMPC1.BBIDOS AS ID_DOSSIER,
					PCDROIT1.BCIDRO AS ID_DROIT
					FROM SCHEMA.PCPCACC PCPCACC1
					INNER JOIN SCHEMA.PCVERDRO PCVERDRO1 ON ( PCPCACC1.CUIVDR=PCVERDRO1.BDIVDR )
					INNER JOIN SCHEMA.PCDROIT PCDROIT1 ON ( PCVERDRO1.BDIDRO=PCDROIT1.BCIDRO )
					INNER JOIN SCHEMA.PCDEMPC PCDEMPC1 ON ( PCDROIT1.BCIDPC=PCDEMPC1.BBIDPC )
					INNER JOIN SCHEMA.REPRACC REPRACC1 ON ( PCPCACC1.CUIPRC=REPRACC1.ZTIPRA ) 
					INNER JOIN SCHEMA.TIPAVSP TIPAVSP1 ON ( REPRACC1.ZTITBE=TIPAVSP1.HTITIE )
					WHERE
					(
					   PCPCACC1.CUTETA=64029002
					   AND ( REPRACC1.ZTITBE = :forIdTiers )
					   AND PCPCACC1.CUBSUP = 2
					   and PCPCACC1.CUDDEB =
					   (
					      select
					      MAX( PCPCACC2.CUDDEB )
					      from  SCHEMA.PCDEMPC PCDEMPC2 
					      inner join SCHEMA.PCDROIT PCDROIT2 on PCDROIT2.BCIDPC = PCDEMPC2.BBIDPC
					      inner join SCHEMA.PCVERDRO PCVERDRO2 on PCVERDRO2.BDIDRO = PCDROIT2.BCIDRO 
					      inner join SCHEMA.PCPCACC PCPCACC2 on PCPCACC2.CUIVDR = PCVERDRO2.BDIVDR
					      where PCDEMPC2.BBIDOS = PCDEMPC1.BBIDOS  
					        AND PCPCACC2.CUBSUP = 2 
					        and PCPCACC2.CUTETA=64029002 
					   )
					)
				order by DATE_DEBUT_PCA DESC
			]]>
		</sql>
	</query>
	<query name="demandeOrdreParDateDeDebut">
		<comment>
			
		</comment>
		<sql>
			<![CDATA[ 

			]]>
		</sql>
	</query>
</queries>
